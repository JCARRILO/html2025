<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../CSS/common.css"><link rel="stylesheet" href="styles.css"><title>Tablas avanzadas en HTML</title>
  
  </head>
<body>
  <a href="#contenido" class="visually-hidden">Saltar al contenido principal</a>
  
  <header class="hero">
    <div class="wrap">
      <p class="kicker">Frontend</p>
      <h1>Tablas avanzadas: estructura, accesibilidad y UX</h1>
      <p class="sub">Ejemplos con <code>&lt;thead&gt;</code>, <code>&lt;tbody&gt;</code>, <code>&lt;tfoot&gt;</code>, encabezados multinivel, <code>rowspan</code>/<code>colspan</code>, <code>colgroup</code>, cabecera pegajosa, ordenamiento y filtrado accesible.</p>
    </div>
  </header>

  <main id="contenido" class="wrap">
    <aside class="lesson-aside" role="complementary" aria-labelledby="aside-title-clase-7">
      <h2 id="aside-title-clase-7">En esta clase</h2>
      <ul>
        <li><span class="dot dot-structure" aria-hidden="true"></span><a href="#k-structure">Estructura de tabla (table, thead, tbody, tfoot)</a></li>
        <li><span class="dot dot-headers" aria-hidden="true"></span><a href="#k-headers">Encabezados y scope (th/td)</a></li>
        <li><span class="dot dot-caption" aria-hidden="true"></span><a href="#k-caption">Caption</a></li>
        <li><span class="dot dot-a11y" aria-hidden="true"></span><a href="#k-a11y">Accesibilidad en tablas</a></li>
        <li><span class="dot dot-schedule" aria-hidden="true"></span><a href="#k-horario">Horario (colspan y filas destacadas)</a></li>
        <li><span class="dot dot-perms" aria-hidden="true"></span><a href="#k-permisos">Matriz de permisos (colgroup y abbr)</a></li>
      </ul>
    </aside>
    <!-- 1) Informe de ventas con cabecera multinivel, colgroup, tfoot, filtro y sort -->
    <section class="section">
      <div class="card k-structure" id="k-structure" tabindex="-1">
        <h2 class="title">1) Informe de ventas 2024</h2>
        <p class="muted">Tabla grande con encabezados multinivel, totales y utilidades de filtrado y ordenamiento.</p>

        <div class="toolbar k-a11y" id="k-a11y" tabindex="-1" role="region" aria-label="Controles de tabla de ventas">
          <label for="filter-ventas" class="small">Filtrar por producto:</label>
          <input id="filter-ventas" type="search" placeholder="Ej. Port&aacute;til, Teclado..." aria-controls="tabla-ventas" aria-describedby="filter-help">
          <span id="filter-help" class="small muted">Escribe para mostrar solo filas coincidentes.</span>
          <button class="btn" id="clear-ventas" type="button">Limpiar filtro</button>
        </div>
        <div id="ventas-status" aria-live="polite" class="small muted" style="margin-top:6px"></div>
        <p class="small muted">Nota: los totales se calculan sobre las filas visibles. Limpia el filtro para ver los totales de todos los productos.</p>

        <div class="table-wrap">
          <table id="tabla-ventas">
  <caption class="k-caption" id="k-caption" tabindex="-1">Informe de ventas por producto y regi&oacute;n (Q1&ndash;Q4 2024)</caption>
  <colgroup>
    <col class="col-prod" span="1">
    <col class="col-region" span="4">
    <col class="col-total total" span="1">
  </colgroup>
  <thead class="k-headers" id="k-headers" tabindex="-1">
    <tr>
      <th scope="col" rowspan="2" id="h-prod">Producto</th>
      <th scope="colgroup" colspan="4" id="h-region">Regi&oacute;n</th>
      <th scope="col" rowspan="2" class="num" id="h-total">Total anual</th>
    </tr>
    <tr>
      <th scope="col" class="sortable" data-type="text" id="h-norte" aria-sort="none" tabindex="0">Norte <span class="arrow"></span></th>
      <th scope="col" class="sortable" data-type="text" id="h-sur" aria-sort="none" tabindex="0">Sur <span class="arrow"></span></th>
      <th scope="col" class="sortable" data-type="text" id="h-este" aria-sort="none" tabindex="0">Este <span class="arrow"></span></th>
      <th scope="col" class="sortable" data-type="text" id="h-oeste" aria-sort="none" tabindex="0">Oeste <span class="arrow"></span></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row" headers="h-prod">Port&aacute;til 14" <span class="tag">Nuevo</span></th>
      <td headers="h-region h-norte">2,340</td>
      <td headers="h-region h-sur">1,980</td>
      <td headers="h-region h-este">2,120</td>
      <td headers="h-region h-oeste">1,760</td>
      <td class="num" headers="h-total">8,200</td>
    </tr>
    <tr>
      <th scope="row" headers="h-prod">Monitor 27"</th>
      <td headers="h-region h-norte">1,120</td>
      <td headers="h-region h-sur">1,250</td>
      <td headers="h-region h-este">980</td>
      <td headers="h-region h-oeste">1,050</td>
      <td class="num" headers="h-total">4,400</td>
    </tr>
    <tr>
      <th scope="row" headers="h-prod">Teclado mec&aacute;nico</th>
      <td headers="h-region h-norte">860</td>
      <td headers="h-region h-sur">910</td>
      <td headers="h-region h-este">790</td>
      <td headers="h-region h-oeste">880</td>
      <td class="num" headers="h-total">3,440</td>
    </tr>
    <tr>
      <th scope="row" headers="h-prod">Rat&oacute;n inal&aacute;mbrico</th>
      <td headers="h-region h-norte">1,540</td>
      <td headers="h-region h-sur">1,420</td>
      <td headers="h-region h-este">1,350</td>
      <td headers="h-region h-oeste">1,230</td>
      <td class="num" headers="h-total">5,540</td>
    </tr>
    <tr>
      <th scope="row" headers="h-prod">Base USB-C</th>
      <td headers="h-region h-norte">640</td>
      <td headers="h-region h-sur">700</td>
      <td headers="h-region h-este">620</td>
      <td headers="h-region h-oeste">680</td>
      <td class="num" headers="h-total">2,640</td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <th scope="row">Totales (visibles)</th>
      <td class="num">6.500</td>
      <td class="num">6.260</td>
      <td class="num">5.860</td>
      <td class="num">5.600</td>
      <td class="num">24.220</td>
    </tr>
  </tfoot>
</table>
        </div>
      </div>
    </section>

    <!-- 2) Horario con rowspan/colspan -->
    <section class="section">
      <div class="card">
        <h2 class="title">2) Horario semanal con celdas combinadas</h2>
        <p class="muted">Ejemplo de <code>rowspan</code> para sesiones continuas y <code>colspan</code> para descansos comunes.</p>
        <div class="toolbar" role="region" aria-label="Controles horario">
          <label for="filter-horario" class="small">Filtrar por materia o d&iacute;a:</label>
          <input id="filter-horario" type="search" placeholder="Ej. JavaScript, Accesibilidad, Lunes" aria-controls="tabla-horario">
          <button class="btn" id="clear-horario" type="button">Limpiar filtro</button>
        </div>
        <div class="table-wrap">
          <table id="tabla-horario">
            <caption class="k-schedule" id="k-horario" tabindex="-1">Horario del curso (Semana tipo)</caption>
            <thead>
              <tr>
                <th scope="col">D&iacute;a</th>
                <th scope="col"> 08:00 - 10:00 </th>
                <th scope="col"> 10:00 - 12:00 </th>
                <th scope="col"> 12:00 - 14:00 </th>
                <th scope="col"> 14:00 - 16:00 </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Lunes</th>
                <td>HTML b&aacute;sico</td>
                <td>CSS layout</td>
                <td colspan="2">Descanso / Estudio libre</td>
              </tr>
              <tr>
                <th scope="row">Martes</th>
                <td>HTML b&aacute;sico</td>
                <td>Flexbox y Grid</td>
                <td>Dise&ntilde;o responsivo</td>
                <td>Proyecto</td>
              </tr>
              <tr>
                <th scope="row">Mi&eacute;rcoles</th>
                <td>Accesibilidad</td>
                <td>JavaScript DOM</td>
                <td>Componentes</td>
                <td>Proyecto</td>
              </tr>
              <tr>
                <th scope="row">Jueves</th>
                <td>Sem&aacute;ntica</td>
                <td>JavaScript DOM</td>
                <td>Pruebas</td>
                <td>Proyecto</td>
              </tr>
              <tr class="full-day">
                <th scope="row">Viernes</th>
                <td>Demo final y retroalimentaci&oacute;n</td>
                <td>Demo final y retroalimentaci&oacute;n</td>
                <td>Demo final y retroalimentaci&oacute;n</td>
                <td>Demo final y retroalimentaci&oacute;n</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 3) Matriz de permisos con colgroup -->
    <section class="section">
      <div class="card">
        <h2 class="title">3) Matriz de permisos (colgroup + &lt;abbr&gt;)</h2>
        <p class="muted">Uso de <code>&lt;colgroup&gt;</code> para estilo por columna y cabeceras claras con <code>&lt;abbr&gt;</code>.</p>
        <div class="table-wrap">
          <table id="tabla-permisos">
            <caption class="k-perms" id="k-permisos" tabindex="-1">Permisos por rol</caption>
            <colgroup>
              <col>
              <col style="background:#fcf7f1">
              <col style="background:#f3fbf5">
              <col style="background:#f3f6fb">
              <col style="background:#f9f3fb">
            </colgroup>
            <thead>
              <tr>
                <th scope="col">Recurso</th>
                <th scope="col"><abbr title="Crear">C</abbr></th>
                <th scope="col"><abbr title="Leer">R</abbr></th>
                <th scope="col"><abbr title="Actualizar">U</abbr></th>
                <th scope="col"><abbr title="Eliminar">D</abbr></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Usuarios</th>
                <td class="num ok">&#10003;</td>
                <td class="num ok">&#10003;</td>
                <td class="num ok">&#10003;</td>
                <td class="num no">&#10007;</td>
              </tr>
              <tr>
                <th scope="row">Productos</th>
                <td class="num ok">&#10003;</td>
                <td class="num ok">&#10003;</td>
                <td class="num ok">&#10003;</td>
                <td class="num ok">&#10003;</td>
              </tr>
              <tr>
                <th scope="row">Pedidos</th>
                <td class="num no">&#10007;</td>
                <td class="num ok">&#10003;</td>
                <td class="num ok">&#10003;</td>
                <td class="num no">&#10007;</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Utilidades: normalizar texto (para ordenamiento/filtrado)
    const norm = s => (s||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').trim();

    // Formatear nï¿½meros del cuerpo de la tabla 1 en es-ES
    function formatVentasBodyES(){
      const table = document.getElementById('tabla-ventas');
      if(!table || !table.tBodies.length) return;
      const nf = new Intl.NumberFormat('es-ES');
      const rows = Array.from(table.tBodies[0].rows);
      const parse = (txt)=>{
        const clean = (txt||'').toString().replace(/[^0-9.,-]/g,'');
        const normalized = clean.indexOf(',')>clean.indexOf('.')
          ? clean.replace(/\./g,'').replace(',', '.')
          : clean.replace(/,/g,'');
        const n = parseFloat(normalized);
        return isNaN(n) ? 0 : n;
      };
      rows.forEach(tr=>{
        for(let i=1;i<tr.cells.length;i++){
          const cell = tr.cells[i];
          const n = parse(cell.textContent);
          cell.textContent = nf.format(Math.round(n));
        }
      });
    }

    
      const recomputeTotalsAndStatus = (function(){
  return function(){
    const table = document.getElementById('tabla-ventas');
    if(!table || !table.tBodies.length || !table.tFoot) return;
    const rows = Array.from(table.tBodies[0].rows);
    const parse = (txt)=>{
      const clean = (txt||'').toString().replace(/[^0-9.,-]/g,'');
      const normalized = clean.indexOf(',')>clean.indexOf('.')
        ? clean.replace(/\./g,'').replace(',', '.')
        : clean.replace(/,/g,'');
      const n = parseFloat(normalized);
      return isNaN(n) ? 0 : n;
    };
    const nfES = new Intl.NumberFormat('es-ES');
    const fmt = (n)=> nfES.format(Math.round(n));
    const sumsVis = [0,0,0,0]; let totalCol = 0;
    rows.forEach(tr=>{
      if(tr.style.display === 'none') return;
      for(let i=0;i<4;i++){
        const val = parse(tr.cells[i+1]?.textContent);
        sumsVis[i] += val;
      }
      totalCol += parse(tr.cells[5]?.textContent);
    });
    const totalVis = totalCol;
    const tds = table.tFoot.rows[0]?.cells;
    if(tds && tds.length>=6){
      tds[1].textContent = fmt(sumsVis[0]);
      tds[2].textContent = fmt(sumsVis[1]);
      tds[3].textContent = fmt(sumsVis[2]);
      tds[4].textContent = fmt(sumsVis[3]);
      tds[5].textContent = fmt(totalVis);
    }
    const statusEl = document.getElementById('ventas-status');
    if(statusEl){
      statusEl.textContent = 'Totales visibles ï¿½ Norte: ' + fmt(sumsVis[0])
        + ', Sur: ' + fmt(sumsVis[1])
        + ', Este: ' + fmt(sumsVis[2])
        + ', Oeste: ' + fmt(sumsVis[3])
        + ', Total: ' + fmt(totalVis);
    }
  }
})();

// Recalcular totales por fila// Recalcular totales por fila (Total anual)
    function updateRowTotals(){
      const table = document.getElementById('tabla-ventas');
      if(!table || !table.tBodies.length) return;
      const nf = new Intl.NumberFormat('es-ES');
      const parse = (txt)=>{
        const clean = (txt||'').toString().replace(/[^0-9.,-]/g,'');
        const normalized = clean.indexOf(',')>clean.indexOf('.')
          ? clean.replace(/\./g,'').replace(',', '.')
          : clean.replace(/,/g,'');
        const n = parseFloat(normalized);
        return isNaN(n) ? 0 : n;
      };
      const rows = Array.from(table.tBodies[0].rows);
      rows.forEach(tr=>{
        const sum = parse(tr.cells[1]?.textContent)
                 + parse(tr.cells[2]?.textContent)
                 + parse(tr.cells[3]?.textContent)
                 + parse(tr.cells[4]?.textContent);
        if(tr.cells[5]) tr.cells[5].textContent = nf.format(Math.round(sum));
      });
    }

    // Inicializacion
    formatVentasBodyES();
    updateRowTotals();
    (function(){
      const input = document.getElementById('filter-ventas');
      const clear = document.getElementById('clear-ventas');
      const table = document.getElementById('tabla-ventas');
      if(!input || !table) return;
      const rows = Array.from(table.tBodies[0].rows);
      function apply(){
        const q = norm(input.value);
        rows.forEach(tr => {
          const cell = tr.cells[0];
          const txt = norm(cell ? cell.textContent : '');
          tr.style.display = q && !txt.includes(q) ? 'none' : '';
        });
        recomputeTotalsAndStatus();
      }
      input.addEventListener('input', apply);
      if(clear) clear.addEventListener('click', ()=>{ input.value=''; input.focus(); apply(); });
      // Totales iniciales
      recomputeTotalsAndStatus();
    })();

    // Ordenamiento accesible por columna (thead de la fila 2)
    (function(){
      const table = document.getElementById('tabla-ventas');
      if(!table) return;
      const headers = table.tHead.rows[1].querySelectorAll('th.sortable');
      let lastIndex = -1; let lastDir = 'none';
      headers.forEach((th, idx)=>{
        th.addEventListener('click', ()=>toggle(idx, th));
        th.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggle(idx, th); } });
      });
      function toggle(index, th){
        const dir = (lastIndex===index && lastDir==='ascending') ? 'descending' : 'ascending';
        sortBy(index, dir);
        headers.forEach(h=>h.setAttribute('aria-sort','none'));
        th.setAttribute('aria-sort', dir);
        lastIndex = index; lastDir = dir;
        recomputeTotalsAndStatus();
        (function(){ const statusEl = document.getElementById('ventas-status'); if(statusEl){ const name = (th.textContent||'').trim(); const dirTxt = dir==='ascending' ? 'ascendente' : 'descendente'; statusEl.textContent = 'Ordenado por ' + name + ' (' + dirTxt + '). ' + statusEl.textContent; } })();\r\n      }
      function sortBy(index, dir){
        const tbody = table.tBodies[0];
        const rows = Array.from(tbody.rows);
        const mult = dir==='ascending' ? 1 : -1;
        rows.sort((a,b)=>{
          const A = a.cells[index+1].textContent.replace(/[^0-9.,-]/g,'');
          const B = b.cells[index+1].textContent.replace(/[^0-9.,-]/g,'');
          const an = parseFloat(A.replace('.', '').replace(',', '.')) || 0;
          const bn = parseFloat(B.replace('.', '').replace(',', '.')) || 0;
          return (an-bn)*mult;
        });
        rows.forEach(r=>tbody.appendChild(r));
        updateRowTotals();
        recomputeTotalsAndStatus();
      }
    })();
      // Filtro de filas por materia/dï¿½a en tabla 2 (horario)
    (function(){
      const input = document.getElementById('filter-horario');
      const clear = document.getElementById('clear-horario');
      const table = document.getElementById('tabla-horario');
      if(!table || !input) return;
      const rows = Array.from(table.tBodies[0].rows);
      const normText = s => (s||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');
      function apply(){
        const q = normText(input.value).trim();
        rows.forEach(tr =>{
          const txt = normText(tr.textContent);
          tr.style.display = q && !txt.includes(q) ? 'none' : '';
        });
      }
      input.addEventListener('input', apply);
      if(clear) clear.addEventListener('click', ()=>{ input.value=''; input.focus(); apply(); });
    })();
    // Estilos y centrado para tabla 3 (permisos)
    (function(){
      const t = document.getElementById('tabla-permisos');
      if(!t) return;
      t.querySelectorAll('th,td').forEach(el=>{
        el.style.textAlign = 'center';
        el.style.verticalAlign = 'middle';
      });
      // Marcar ? / ? con clases para colores
      t.querySelectorAll('tbody td.num').forEach(td=>{
        const txt = (td.textContent||'').trim();
        td.classList.remove('ok','no');
        if(txt === '?' || txt === '\u2713') td.classList.add('ok');
        else if(txt === '?' || txt === '\u2717') td.classList.add('no');
      });
    })();</script>

</body>
</html>










